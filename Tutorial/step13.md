# Aiursoft Template Tutorial - Step 13 - 课后练习

这部分留给你自己完成。你可以尝试添加更多的功能。到这里以后，相信完成下面的功能对你来说已经不再是难事了。

这些功能不仅能极大地丰富你的应用，还能让你在实践中深入掌握更多关于数据库设计、后端架构、前端交互和性能优化的专业知识。祝你玩得开心！

## Step 13.1 Markdown 支持多种隐私选项

现在，Markdown 保存好了以后只能自己看。我们可以尝试添加更多的隐私选项，例如：

* 公开：任何人都可以查看这个文档。
* 私密：只有自己可以查看这个文档。
* 不出现在列表中：只有知道链接的人才能查看这个文档。
* 密码保护：访问这个文档需要输入密码。
* 分享给特定的用户组：只有特定的用户组可以查看这个文档。

同样，对于公开的，但不属于自己的文档，我们也需要构建单独的预览页面。这样，当用户浏览自己的文档时，可以快速判断它们是公开的还是私密的。并且可以直接复制公开文档的分享链接发给其他人。其他人打开公开文档的链接时，可以看到一个简洁的预览页面。

## Step 13.2 支持其它格式

除了 Markdown，我们还可以支持更多的格式，例如：

* Mermaid：一种用于绘制图表和流程图的文本格式。
* LaTeX：一种用于排版数学公式和科学文档的标记语言。
* HTML：直接输入 HTML 代码，并渲染成网页。
* 富文本格式（WYSIWYG）：允许用户使用类似 Word 的编辑器来创建和编辑文档。

## Step 13.3 搜索

我们可以尝试实现搜索功能，允许用户根据标题或内容搜索他们的文档。可以使用全文索引或者简单的字符串匹配来实现这个功能。甚至可以支持模糊搜索和高级搜索选项。

## Step 13.4 文档版本历史与回滚

用户在编辑文档时，可能会误删重要内容或想找回之前的某个版本。实现一个版本控制系统，让每一次保存都成为一个可追溯的历史记录。

这需要妥善的设计数据结构，例如：

* 可以每次提交都完整的保存一份文档的快照，这样方便实现，并且可以支持任意版本的回滚。但缺点是会占用较多的存储空间。
* 也可以只保存每次修改的差异（diff），这样节省存储空间，但实现起来相对复杂一些。

## Step 13.5 高级组织：文件夹与标签系统

当文档数量增多时，一个扁平的列表将变得难以管理。引入文件夹和标签来帮助用户组织他们的文档。

这需要妥善设计数据库结构，例如：

* 文件夹表：存储文件夹信息，如名称、创建时间、用户ID等。
* 标签表：存储标签信息，如名称、颜色等。
* 文档-标签关联表：实现多对多关系，允许一个文档有多个标签。
* 文档-文件夹关联：允许一个文档属于一个文件夹。
* 用户-文件夹关联：允许用户创建和管理自己的根文件夹。

## Step 13.6 性能优化：分页加载

如果一个用户有成百上千篇文档，“我的文档”页面一次性加载所有文档会导致页面加载缓慢，并给服务器和数据库带来压力。通过分页加载，只加载当前页的文档，提升用户体验。

这需要为列表页面增加两个参数 `page` 和 `pageSize`，并在数据库查询时使用 `Skip` 和 `Take` 方法来实现分页。它们会被翻译成 SQL 语句中的 `OFFSET` 和 `LIMIT`，从而只查询需要的数据。

## Step 13.7 支持 PostgreSQL

我们已经支持了 SQLite 和 MySQL，现在可以尝试添加对 PostgreSQL 的支持。PostgreSQL 是一个功能强大且广泛使用的开源关系型数据库管理系统。通过添加对 PostgreSQL 的支持，可以让应用程序适应更多的部署环境和用户需求。

Aiursoft Template 的设计中，不需要修改任何核心代码，就可以轻松地添加对新的数据库的支持。你只需要模仿 MySql、Sqlite 的实现，创建一个新的 PostgreSql 支持类，并确保在配置文件中正确设置连接字符串和数据库类型即可。
